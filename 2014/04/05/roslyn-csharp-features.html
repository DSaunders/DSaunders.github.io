<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>What's new in C#</title>
    <meta name="viewport" content="width=device-width; initial-scale=1.0;" />
    <meta name="description" content="">
    <meta name="author" content="Dave Saunders">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">

  </head>
  <body class="blog-post">

    <header id="header">

        <h1>
        <a href="/blog.html">Dave Saunders</a>
        </h1>

    </header>

    <div class="post">

  <h2>What's new in C#</h2>
  <p class="meta">Originally posted in April 2014</p>

  <content class="post-content" role="article">
    <p>At Build 2014, Microsoft unveiled a few new features of C#.
Some of these are simply ‘syntactic sugar’, while others are
going to be really useful.</p>

<p>Here’s a few of my favourites.</p>

<p>#Statics in Using Statements</p>

<p>Visual Basic had this already, but statics in using statements are now in C#.</p>

<p>This means that you can add static classes as using statements, bringing all
of that class’ static members into scope.</p>

<p>Essentially it means you can now replace this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Another Message&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p>with this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">Console</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Hello world&quot;</span><span class="p">);</span>
    <span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Another Message&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p>This is a small change, but could help to make code more readable.</p>

<p>#Primary Constructors</p>

<p>We write code like this all the time:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Shape</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">_sides</span><span class="p">;</span>

  <span class="k">public</span> <span class="nf">Shape</span><span class="p">(</span><span class="kt">int</span> <span class="n">sides</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">_sides</span> <span class="p">=</span> <span class="n">sides</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</figure>

<p>This is a constructor that takes an argument, that is then stored in a private member.
This is especially common when using an IoC container; where we pass in
our dependencies, store them in private members and use them later.</p>

<p>C# can now generate this boilerplate constructor code for us, and it looks a lot nicer:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nf">Shape</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sides</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">_sides</span> <span class="p">=</span> <span class="n">sides</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</figure>

<p>In fact, you don’t even need to define the <em>private readonly</em> backing
variable; you can declare access modifiers for the members like this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nf">Shape</span> <span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">sides</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span></code></pre>
</figure>

<p>This means that a constructor will be auto-generated, taking <em>sides</em> as an
argument. It will then be mapped to a <em>private readonly</em> member variable.</p>

<p>#Binary literals</p>

<p>You can now declare binary literals, and use ‘spacers’ in them to make them
more readable. Like this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">binaryValue</span> <span class="p">=</span> <span class="p">&amp;</span><span class="m">0010</span><span class="n">_0100</span></code></pre>
</figure>

<p>#Dictionary Initialisers</p>

<p>In the latest C#, you can populate indexers when initialising objects.</p>

<p>Replacing:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">someClass</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="p">();</span>
<span class="n">someClass</span><span class="p">[</span><span class="s">&quot;value1&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="m">1</span>
<span class="n">someClass</span><span class="p">[</span><span class="s">&quot;value2&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;Hello World&quot;</span><span class="p">;</span></code></pre>
</figure>

<p>with:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">someClass</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="p">()</span> <span class="p">{</span> <span class="p">[</span><span class="s">&quot;value1&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;value2&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;Hello World&quot;</span> <span class="p">};</span></code></pre>
</figure>

<p>#Indexed Members</p>

<p>There is a new addition that means you can make indexers
look a little more like ‘normal’ members, so that:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="n">myClass</span><span class="p">[</span><span class="s">&quot;Value1&quot;</span><span class="p">]</span></code></pre>
</figure>

<p>can now be written as:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="n">myClass</span><span class="p">.</span><span class="err">$</span><span class="n">Value1</span></code></pre>
</figure>

<p>This isn’t much, but it certainly looks a lot neater.</p>

<p>#Declaration Expressions</p>

<p>This is my <em>favourite</em> new feature. It’s only small, but it’s something i’ve been
wanting for a long time.</p>

<p>You can now declare variables anywhere, which means you can finally
declare your out parameters as you use them, rather than on the line
before.</p>

<p>No more of this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">outValue</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">someValue</span><span class="p">,</span> <span class="k">out</span> <span class="n">outValue</span><span class="p">);</span></code></pre>
</figure>

<p>Now we can do this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">someValue</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">outValue</span><span class="p">);</span></code></pre>
</figure>

<p>The compiler can infer the type of the out parameter; so we
are even allowed to use <em>var</em> here.</p>

<p>#Exception Filters</p>

<p>This is another Visual Basic feature that is coming to C#. It wasn’t shown in
the demo at Build, but it allows us to add filters to our catch blocks.</p>

<p>It will probably look something like this:</p>

<figure class="highlight">
  <pre><code class="language-csharp" data-lang="csharp"><span class="k">try</span>
<span class="p">{</span>

<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">myVariable</span> <span class="p">==</span> <span class="n">someValue</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Some exception code that happens when the catch fires</span>
  <span class="c1">//  and myVariable ==  someValue</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Catch everything else..</span>
<span class="p">}</span></code></pre>
</figure>

<p>#So when can I use it?</p>

<p>These features are currently in preview as part of the latest Roslyn release.
It’s probably best not to use this stuff in production yet, but we can already
download it and play around with it until it’s officially released.</p>

<p>You can find it
<a href="http://msdn.microsoft.com/en-gb/vstudio/roslyn.aspx" target="_blank">here</a></p>

  </content>

  <div class="post-footer">
    <span class="related-links">
      <h3>You might also like:</h3>
      <ul>
        
        <li><a href="/2015/05/10/how-to-ask-for-estimates.html">How old was Gandhi? (or how to ask for software estimates)</a></li>
        
        <li><a href="/2015/04/26/paging-in-restful-web-services.html">Query string paging in RESTful web services</a></li>
        
        <li><a href="/2015/03/03/standups-youre-doing-it-wrong.html">The Daily Stand-up - You’re doing it wrong</a></li>
        
      </ul>
    </span>
    <span class="social-links">
      <h3>Follow me!</h3>
      <a
      href="https://twitter.com/DaveJSaunders"
      class="tweet-link"
      title="Follow @DaveJSaunders" target="_blank"></a>
    </span>
  </div>

</div>



    <script>
    	var _gaq = _gaq || [];
    	var _gaq = [['_setAccount', 'UA-40239142-1']];

    	// Track page view
    	_gaq.push(
    		['_trackPageview']
    	);

    	(function () {
    		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    	})();
    </script>

    <!-- Drip -->
    <script type="text/javascript">
      var _dcq = _dcq || [];
      var _dcs = _dcs || {}; 
      _dcs.account = '1265048';
      
      (function() {
        var dc = document.createElement('script');
        dc.type = 'text/javascript'; dc.async = true; 
        dc.src = '//tag.getdrip.com/1265048.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(dc, s);
      })();
    </script>

    
    <script type="text/javascript" src="//use.typekit.net/lmg7vwv.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    </body>
</html>
